<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</title>
<link rel="icon" href="./pictures/favicon.ico" type="image/x-icon">
<!-- å¯èƒ½ãªã‚‰å…±é€šã® style.css ã‚’ä½¿ã†ã€‚ä¸‹ã®styleã¯æœ€ä½é™ã®è£œåŠ© -->
<link rel="stylesheet" href="./style.css">
<style>
    .form-container{max-width:460px;margin:40px auto;background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .form-container h2{text-align:center;margin:0 0 1.2rem}
    label{display:block;margin-top:1rem;font-weight:600}
    input[type="text"],input[type="email"],input[type="password"]{width:100%;padding:.75rem;font-size:1rem;margin-top:.3rem;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
    .btn{margin-top:1rem;width:100%;background:#43aa8b;color:#fff;border:none;padding:.9rem;font-size:1.05rem;border-radius:8px;cursor:pointer;font-weight:700}
    .btn:hover{background:#368a70}
    .btn-google{background:#4285f4}
    .btn-google:hover{background:#366fca}
    .help{font-size:.9rem;color:#666;margin-top:.5rem}
    .error{margin-top:.75rem;color:#c0392b;font-weight:600}
    .success{margin-top:.75rem;color:#2e7d32;font-weight:600}
</style>
</head>
<body>
<main>
    <div class="form-container">
    <h2>ğŸ“œ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h2>

    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ displayName ã¨ã—ã¦ä¿å­˜ã™ã‚‹ç”¨ -->
    <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å
        <input type="text" id="username" placeholder="ä¾‹ï¼‰ç¾é¦™ç´…èŒ¶" required />
    </label>

    <label>ãƒ¡ãƒ¼ãƒ«
        <input type="email" id="email" placeholder="you@example.com" required />
    </label>

    <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        <input type="password" id="password" placeholder="8æ–‡å­—ä»¥ä¸Šã‚’æ¨å¥¨" required />
    </label>

        <button id="registerBtn" class="btn">ç™»éŒ²ã™ã‚‹ï¼ˆEmail/Passwordï¼‰</button>
        <!-- Googleèªè¨¼ã¯ã‚„ã‚ã¾ã—ãŸã€‚ -->
        <!-- <button id="googleBtn" class="btn btn-google" type="button">Googleã§ç¶šè¡Œ</button> -->

        <div class="help">æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚‹ï¼Ÿ <a href="./login.html">ãƒ­ã‚°ã‚¤ãƒ³ã¸</a></div>
        <div id="msg" class=""></div>
    </div>
</main>

<!-- Firebase v10+ CDNï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‰ˆï¼‰ -->
<script type="module">
    // ===== Firebase åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
        getAuth, onAuthStateChanged, createUserWithEmailAndPassword,
        signInWithPopup, GoogleAuthProvider, updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    // ï¼ˆä»»æ„ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’DBã«ã‚‚ä¿å­˜ã™ã‚‹å ´åˆï¼‰
    // import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

// â˜…githubã‚¢ãƒƒãƒ—æ™‚ã«å¿˜ã‚Œãšæ¶ˆã™ã“ã¨ï¼â˜…
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    // const db = getFirestore(app);

    const msg = document.getElementById("msg");
    const showMsg = (text, ok=false) => {
        msg.textContent = text;
        msg.className = ok ? "success" : "error";
    };

    // æ—¢ãƒ­ã‚°ã‚¤ãƒ³ãªã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒšãƒ¼ã‚¸ä¿è­·ã®å…¥å£ã«ã‚‚ãªã‚‹ï¼‰
    onAuthStateChanged(auth, user => {
    if (user) {
        // ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ãã®ã¾ã¾ã‚¢ãƒ—ãƒªã¸
        location.href = "./home.html"; // é·ç§»å…ˆã¯å¥½ã¿ã§
    }
    });

// ===== Email/Password ã§ç™»éŒ² =====
    document.getElementById("registerBtn").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!username || !email || !password) {
        showMsg("æœªå…¥åŠ›ã®é …ç›®ãŒã‚ã‚Šã¾ã™ã€‚");
        return;
    }

    try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);

        // è¡¨ç¤ºåï¼ˆdisplayNameï¼‰ã‚’æ›´æ–°
        await updateProfile(cred.user, { displayName: username });

        // ä»»æ„ï¼šFirestoreã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜ã—ãŸã„å ´åˆ
        // await setDoc(doc(db, "users", cred.user.uid), {
        //   username, email, createdAt: serverTimestamp()
        // });

        showMsg("ç™»éŒ²ã«æˆåŠŸã—ã¾ã—ãŸã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™â€¦", true);
        setTimeout(() => location.href = "./home.html", 600);
    } catch (e) {
        // ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’äººé–“èªã«
        const map = {
        "auth/email-already-in-use": "ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚",
        "auth/invalid-email": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒä¸æ­£ã§ã™ã€‚",
        "auth/weak-password": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™ï¼ˆ6æ–‡å­—ä»¥ä¸Šæ¨å¥¨ï¼‰ã€‚",
        };
        showMsg(map[e.code] || `ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.code}`);
    }
});

// ===== Google ã§ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³(ã‚„ã‚ã¾ã—ãŸ) =====
// document.getElementById("googleBtn").addEventListener("click", async () => {
//     try {
//         const provider = new GoogleAuthProvider();
//         await signInWithPopup(auth, provider);
//         // åˆå›æ™‚ã« displayName ã¯Googleå´ã‹ã‚‰å…¥ã‚‹
//         // ä»»æ„ï¼šFirestoreã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒç„¡ã‘ã‚Œã°ä½œæˆâ€¦ãªã©ã‚‚å¯
//         location.href = "./home.html";
//     } catch (e) {
//         showMsg(`Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ï¼š${e.code}`);
//     }
// });
</script>
</body>
</html>

