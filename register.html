<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>ユーザー登録</title>
<link rel="icon" href="./pictures/favicon.ico" type="image/x-icon">
<!-- 可能なら共通の style.css を使う。下のstyleは最低限の補助 -->
<link rel="stylesheet" href="./style.css">
<style>
    .form-container{max-width:460px;margin:40px auto;background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .form-container h2{text-align:center;margin:0 0 1.2rem}
    label{display:block;margin-top:1rem;font-weight:600}
    input[type="text"],input[type="email"],input[type="password"]{width:100%;padding:.75rem;font-size:1rem;margin-top:.3rem;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
    .btn{margin-top:1rem;width:100%;background:#43aa8b;color:#fff;border:none;padding:.9rem;font-size:1.05rem;border-radius:8px;cursor:pointer;font-weight:700}
    .btn:hover{background:#368a70}
    .btn-google{background:#4285f4}
    .btn-google:hover{background:#366fca}
    .help{font-size:.9rem;color:#666;margin-top:.5rem}
    .error{margin-top:.75rem;color:#c0392b;font-weight:600}
    .success{margin-top:.75rem;color:#2e7d32;font-weight:600}
</style>
</head>
<body>
<main>
    <div class="form-container">
    <h2>📜 ユーザー登録</h2>

    <!-- ユーザー名は displayName として保存する用 -->
    <label>ユーザー名
        <input type="text" id="username" placeholder="例）美香紅茶" required />
    </label>

    <label>メール
        <input type="email" id="email" placeholder="you@example.com" required />
    </label>

    <label>パスワード
        <input type="password" id="password" placeholder="8文字以上を推奨" required />
    </label>

        <button id="registerBtn" class="btn">登録する（Email/Password）</button>
        <!-- Google認証はやめました。 -->
        <!-- <button id="googleBtn" class="btn btn-google" type="button">Googleで続行</button> -->

        <div class="help">既にアカウントがある？ <a href="./login.html">ログインへ</a></div>
        <div id="msg" class=""></div>
    </div>
</main>

<!-- Firebase v10+ CDN（モジュール版） -->
<script type="module">
    // ===== Firebase 基本セットアップ =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
        getAuth, onAuthStateChanged, createUserWithEmailAndPassword,
        signInWithPopup, GoogleAuthProvider, updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    // （任意：ユーザープロファイルをDBにも保存する場合）
    // import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

// ★githubアップ時に忘れず消すこと！★
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    // const db = getFirestore(app);

    const msg = document.getElementById("msg");
    const showMsg = (text, ok=false) => {
        msg.textContent = text;
        msg.className = ok ? "success" : "error";
    };

    // 既ログインならリダイレクト（ページ保護の入口にもなる）
    onAuthStateChanged(auth, user => {
    if (user) {
        // すでにログイン済みならそのままアプリへ
        location.href = "./home.html"; // 遷移先は好みで
    }
    });

// ===== Email/Password で登録 =====
    document.getElementById("registerBtn").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!username || !email || !password) {
        showMsg("未入力の項目があります。");
        return;
    }

    try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);

        // 表示名（displayName）を更新
        await updateProfile(cred.user, { displayName: username });

        // 任意：Firestoreにプロフィール保存したい場合
        // await setDoc(doc(db, "users", cred.user.uid), {
        //   username, email, createdAt: serverTimestamp()
        // });

        showMsg("登録に成功しました。リダイレクトします…", true);
        setTimeout(() => location.href = "./home.html", 600);
    } catch (e) {
        // よくあるエラーを人間語に
        const map = {
        "auth/email-already-in-use": "このメールは既に登録されています。",
        "auth/invalid-email": "メールアドレスの形式が不正です。",
        "auth/weak-password": "パスワードが弱すぎます（6文字以上推奨）。",
        };
        showMsg(map[e.code] || `登録に失敗しました：${e.code}`);
    }
});

// ===== Google で登録/ログイン(やめました) =====
// document.getElementById("googleBtn").addEventListener("click", async () => {
//     try {
//         const provider = new GoogleAuthProvider();
//         await signInWithPopup(auth, provider);
//         // 初回時に displayName はGoogle側から入る
//         // 任意：Firestoreにプロフィールが無ければ作成…なども可
//         location.href = "./home.html";
//     } catch (e) {
//         showMsg(`Googleログインに失敗：${e.code}`);
//     }
// });
</script>
</body>
</html>

