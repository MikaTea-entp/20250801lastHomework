<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SCAMPER Novelist â€“ è¦–ç‚¹ã‚¬ãƒãƒ£</title>
<style>
  :root { --bg:#0f172a; --card:#111827; --fg:#e5e7eb; --muted:#9ca3af; --acc:#22d3ee; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#0b1222,#0f172a 30%,#0b1222);color:var(--fg)}
  header{padding:20px 16px;text-align:center}
  header h1{margin:0;font-size:1.4rem;letter-spacing:.02em}
  header p{margin:.25rem 0 0;color:var(--muted)}
  main{max-width:960px;margin:0 auto;padding:16px;display:grid;gap:16px}
  .card{background:rgba(17,24,39,.6);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.25);backdrop-filter: blur(6px)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{display:inline-flex;align-items:center;gap:8px;font-size:.95rem;color:var(--muted)}
  input[type="checkbox"]{width:18px;height:18px;accent-color:var(--acc)}
  select,input[type="text"]{width:100%;background:#0b1020;border:1px solid rgba(255,255,255,.12);color:var(--fg);border-radius:10px;padding:10px 12px;font-size:1rem}
  .btn{border:1px solid rgba(255,255,255,.16);background:#0b1327;color:#e6fbff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  .btn:hover{border-color:var(--acc)}
  .muted{color:var(--muted);font-size:.9rem}
  .pill{display:inline-block;background:#0a1a2f;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;font-size:.85rem;color:#bfeaff}
  .result{font-size:1.02rem;line-height:1.6}
  .grid{display:grid;gap:12px}
  @media(min-width:960px){.grid-2{grid-template-columns:1fr 1fr}}
  h2{margin:.4em 0 0}
  ul{margin:.4em 0 .2em 1.25em}
  .small{font-size:.85rem}
  .hidden{display:none}
</style>
</head>

<body>
<header>
    <h1>ğŸ² SCAMPER Novelist â€“ è¦–ç‚¹ã‚¬ãƒãƒ£</h1>
    <p>ãƒã‚§ãƒƒã‚¯ã—ãŸã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ã€Œã©ã®è¦–ç‚¹ã§è€ƒãˆã‚‹ã‹ã€ã‚’ã‚¬ãƒãƒ£ã‚‹ã€‚ãŠé¡Œã¯æ‰‹å…¥åŠ› or Favs/Journalsã‹ã‚‰æŠ½é¸ã€‚</p>
</header>

<main>
<section class="card">
    <div class="row" style="justify-content:space-between">
        <div class="row">
            <label><input type="checkbox" class="sc" value="S" checked>S â€“ Substitute</label>
            <label><input type="checkbox" class="sc" value="C" checked>C â€“ Combine</label>
            <label><input type="checkbox" class="sc" value="A" checked>A â€“ Adapt</label>
            <label><input type="checkbox" class="sc" value="M" checked>M â€“ Modify</label>
            <label><input type="checkbox" class="sc" value="P" checked>P â€“ Put to other use</label>
            <label><input type="checkbox" class="sc" value="E" checked>E â€“ Eliminate</label>
            <label><input type="checkbox" class="sc" value="R" checked>R â€“ Reverse/Rearrange</label>
        </div>
        <span class="pill" id="authState">æœªãƒ­ã‚°ã‚¤ãƒ³</span>
    </div>

    <div class="grid grid-2">
        <div class="card">
            <h3 style="margin-top:0">ãŠé¡Œï¼ˆãƒ¢ãƒãƒ¼ãƒ•/ãƒ†ãƒ¼ãƒï¼‰</h3>
        <div class="grid">
            <select id="targetSource">
                <option value="manual">æ‰‹å…¥åŠ›</option>
                <option value="favs">Favsã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ </option>
                <option value="journals">Journalsã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ </option>
            </select>
            <input id="manualTopic" type="text" placeholder="ä¾‹ï¼‰ã€å»ƒæ ¡ã«ãªã£ãŸéŸ³æ¥½å®¤ã€ã€å¿˜ã‚Œã‚‰ã‚Œãªã„å¤ç¥­ã‚Šã€ãªã©">
            <div class="row" style="gap:8px">
                <button class="btn" id="pullRandom" title="é¸æŠãŒ Favs/Journals ã®ã¨ãã®ã¿">ãƒ©ãƒ³ãƒ€ãƒ å–å¾—</button>
                <span id="devHint" class="muted small hidden">DEV: Firestore paths = users/{uid}/favs & users/{uid}/journals</span>
            </div>
        </div>
    </div>

    <div class="card">
        <h3 style="margin-top:0">ã‚¬ãƒãƒ£è¨­å®š</h3>
        <div class="grid">
            <label>ä½•å€‹å¼•ãï¼Ÿ
                <select id="numPicks">
                    <option>1</option><option selected>2</option><option>3</option>
                </select>
            </label>
            <label><input type="checkbox" id="autoTitle" checked> ã‚¿ã‚¤ãƒˆãƒ«é››å½¢ã‚’åŒæ™‚ã«ä½œã‚‹</label>
            </div>
        </div>
    </div>

    <div class="row" style="justify-content:flex-end; gap:8px; margin-top:8px">
        <button class="btn" id="draw">ğŸ² è¦–ç‚¹ã‚’ã‚¬ãƒãƒ£ã‚‹</button>
        <button class="btn" id="copy">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        <button class="btn" id="saveJournal" title="Firestoreã«ä¿å­˜">ğŸ’¾ ä½œå“æ¡ˆã«ä¿å­˜</button>
    </div>
</section>

    <section class="card">
      <h3 style="margin-top:0">çµæœ</h3>
      <div id="result" class="result"></div>
    </section>
  </main>

<!-- Firebase v10+ CDN -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, serverTimestamp, query, limit } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // è¿½åŠ ï¼ˆçµ±ä¸€ç®¡ç†ï¼‰
    const COL = { favs: 'favs', journals: 'journals', ideas: 'ideas' };
    const userCol = (uid, name) => collection(db, `users/${uid}/${COL[name]}`);


// === Firebase è¨­å®š ===
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
};

    // ====== åˆæœŸåŒ– ======
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // DEVåˆ¤å®šï¼šlocalhostã®ã¿UID/ãƒ’ãƒ³ãƒˆè¡¨ç¤º
    const DEV = ['localhost','127.0.0.1'].includes(location.hostname);
    const badge = document.getElementById('authState');
    const devHint = document.getElementById('devHint');
    if (DEV) devHint.classList.remove('hidden');

    onAuthStateChanged(auth, async (user) => {
        if (!user) { try { await signInAnonymously(auth); return; } catch(e) {} }
        if (auth.currentUser) badge.textContent = DEV ? `uid: ${auth.currentUser.uid.slice(0,6)}â€¦` : 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­';
        else badge.textContent = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
    });

    // ===== SCAMPER å®šç¾©ï¼ˆè¦–ç‚¹ï¼ãƒ©ãƒ™ãƒ«ï¼‹èª¬æ˜ï¼‹å•ã„ï¼‰=====
    const LABEL = {S:"Substitute",C:"Combine",A:"Adapt",M:"Modify",P:"Put to other use",E:"Eliminate",R:"Reverse/Rearrange"};

const DESC = {
    S:"è¦ç´ ãƒ»ç«‹å ´ãƒ»åª’ä½“ã‚’åˆ¥ã®ã‚‚ã®ã«ç½®ãæ›ãˆã¦ã¿ã‚‹è¦–ç‚¹ã€‚",
    C:"é›¢ã‚ŒãŸè¦ç´ ã‚’æŸã­ãŸã‚Šä¸¦èµ°ã•ã›ã¦æ–°ã—ã„é–¢ä¿‚ã‚’ä½œã‚‹è¦–ç‚¹ã€‚",
    A:"ä»–ã®æ–‡è„ˆãƒ»åˆ¶ç´„ãƒ»å¸‚å ´ã«å½“ã¦ã¯ã‚ã¦ã¿ã‚‹è¦–ç‚¹ã€‚",
    M:"å¼·å¼±ã‚’ã„ã˜ã‚‹ï¼ç²’åº¦ã‚„ãƒ«ãƒ¼ãƒ«ã‚’æ”¹é€ ã—ã¦ã¿ã‚‹è¦–ç‚¹ã€‚",
    P:"å‰¯ç”£ç‰©ã‚„æ—¢å­˜è³‡ç”£ã‚’åˆ¥ç”¨é€”ã«è»¢ç”¨ã™ã‚‹è¦–ç‚¹ã€‚",
    E:"â€œãªãã¦ã‚‚æˆç«‹ã™ã‚‹ã‚‚ã®â€ã‚’æ€ã„åˆ‡ã£ã¦å‰Šã‚‹è¦–ç‚¹ã€‚",
    R:"é †åºã‚„å½¹å‰²ã‚’å…¥ã‚Œæ›¿ãˆã¦å› æœã‚’åè»¢ã•ã›ã‚‹è¦–ç‚¹ã€‚"
};

const QUESTIONS = {
    S:[
        "èª°ã‚’/ä½•ã‚’åˆ¥ã®å­˜åœ¨ã«ç½®ãæ›ãˆã‚‹ã¨ç‰©èªãŒå¤‰ã‚ã‚‹ï¼Ÿ",
        "å¥½ããªæœ¬ã®ç™»å ´äººç‰©ãŒã‚ãªãŸã ã£ãŸã‚‰ï¼Ÿ",
        "èªã‚Šæ‰‹ã‚’å¤‰ãˆã‚‹ã¨â€œçœŸç›¸â€ã¯åˆ¥ã®é¡”ã«ãªã‚‹ï¼Ÿ"
    ],
    C:[
        "ç„¡é–¢ä¿‚ã«è¦‹ãˆã‚‹å‡ºæ¥äº‹ã‚’åŒæ™‚é€²è¡Œã§çµã¶ã¨ä½•ãŒéœ²ã‚ã«ï¼Ÿ",
        "ç§‘å­¦ã¨å‘ªè¡“ã€æ³•ã¨æ…£ç¿’ãªã©â€œäºŒé‡ã®ç†â€ã‚’å…±å­˜ã•ã›ã‚‹ã¨ï¼Ÿ",
        "äºŒäººã®ä¸€äººç§°ã‚’äº¤äº’ã«ä¸¦ã¹ã‚‹ã¨çŸ›ç›¾ã¯ã©ã“ã«ç”Ÿã¾ã‚Œã‚‹ï¼Ÿ"
    ],
    A:[
        "å¤ã„ãƒ¢ãƒãƒ¼ãƒ•ã‚’ç¾ä»£ã®SNS/ä¼æ¥­/è¡Œæ”¿ã«å½“ã¦ã¯ã‚ãŸã‚‰ï¼Ÿ",
        "åˆ¥ã®æ–‡åŒ–åœãƒ»åˆ¶åº¦ã®åˆ¶ç´„ä¸‹ã§åŒã˜äº‹ä»¶ã¯ã©ã†å¤‰è³ªï¼Ÿ",
        "é•ã†å¹´é½¢å±¤ãƒ»è·æ¥­ã®ä¸»äººå…¬ãªã‚‰ä½•ã‚’å„ªå…ˆã™ã‚‹ï¼Ÿ"
    ],
    M:[
        "å ´æ‰€ã‚„æ™‚é–“ã‚’å¤‰ãˆã‚‹ã¨ï¼Ÿ",
        "å­˜åœ¨ã—ãªã„ãƒ«ãƒ¼ãƒ«ã‚„æ³•å¾‹ã‚’ä»®å®šã™ã‚‹ã¨ï¼Ÿ",
        "å®¶æ—ã‚„å‹äººã®å€‹æ€§ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã—ã¦ã¿ã‚‹ã¨ï¼Ÿ"
    ],
    P:[
        "æ—¢å­˜ã®æœ¬ãƒ»æ˜ ç”»ãƒ»æ¥½æ›²ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚ªãƒãƒ¼ã‚¸ãƒ¥ã™ã‚‹ã¨ï¼Ÿ",
        "éå»ã«æ›¸ã“ã†ã¨ã—ãŸä½œå“ã®ä¸€éƒ¨ã‚’ä½¿ã„ã¾ã‚ã™ãªã‚‰ï¼Ÿ",
        "æ€æƒ³ãƒ»å“²å­¦ãƒ»åè¨€ãªã©ã‹ã‚‰ãƒ’ãƒ³ãƒˆã¯å¾—ã‚‰ã‚Œã‚‹ï¼Ÿ"
    ],
    E:[
        "ä¼šè©±/å›ºæœ‰å/å…‰æº/å¶ç„¶ã®ã©ã‚Œã‚’æ¶ˆã™ã¨ç·Šå¼µãŒå¢—ã™ï¼Ÿ",
        "â€œèª¬æ˜â€ã‚’å‰Šã£ã¦æå†™ã ã‘ã§ã©ã“ã¾ã§ä¼ãˆã‚‰ã‚Œã‚‹ï¼Ÿ",
        "æ™‚é–“è¡¨è¨˜ã‚’æ¶ˆã™ã¨èª­è€…ã«ä½•ã‚’å§”ã­ã‚‰ã‚Œã‚‹ï¼Ÿ"
    ],
    R:[
        "çµæœ«â†’ç™ºç«¯ã®é †ã§èªã‚‹ã¨ä½•ãŒâ€œè¬â€ã¨ã—ã¦æ®‹ã‚‹ï¼Ÿ",
        "ä¸»å½¹ã¨ãƒ¢ãƒ–ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã¨ä¸–ç•Œè¦³ã¯ã©ã†è»¢ã¶ï¼Ÿ",
        "è¿½ã†/è¿½ã‚ã‚Œã‚‹ã®ä¸»å¾“ã‚’é€†è»¢ã™ã‚‹ã¨å‹•æ©Ÿã¯ã©ã†éœ²ã‚ã«ï¼Ÿ"
    ]
};

// ã‚¿ã‚¤ãƒˆãƒ«é››å½¢ç”¨ï¼šè»½ã„ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼
    const GENRES  = ["æ–‡å­¦","ãƒŸã‚¹ãƒ†ãƒª","SF","ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼","æ‹æ„›","ç¤¾ä¼šæ´¾","ãƒ›ãƒ©ãƒ¼","ç¾¤åƒåŠ‡"];
    const SETTINGS= ["æ±äº¬","åœ°æ–¹éƒ½å¸‚","æµ·å¤–","å®‡å®™ã‚³ãƒ­ãƒ‹ãƒ¼","å­¦æ ¡","æ¸©æ³‰åœ°","ç ‚æ¼ éƒ½å¸‚","é«˜å±¤å›£åœ°"];
    const TONES   = ["é™è¬","ç–¾èµ°","é™°é¬±","ã‚¢ã‚¤ãƒ­ãƒ‹ãƒƒã‚¯","ç‘ã€…ã—ã„","ä¹¾ã„ãŸ","ä¸ç©","æ¸©ã‹ã„"];

// ===== UI å‚ç…§ =====
    const manualTopic  = document.getElementById('manualTopic');
    const targetSource = document.getElementById('targetSource');
    const pullBtn      = document.getElementById('pullRandom');
    const drawBtn      = document.getElementById('draw');
    const copyBtn      = document.getElementById('copy');
    const saveBtn      = document.getElementById('saveJournal');
    const resultEl     = document.getElementById('result');
    const numPicksSel  = document.getElementById('numPicks');
    const autoTitleChk = document.getElementById('autoTitle');

    const chk = () => Array.from(document.querySelectorAll('.sc:checked')).map(x=>x.value);
    const rnd = (arr) => arr[Math.floor(Math.random()*arr.length)];
    function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[c]))}

async function getRandomDoc(path){
    const uid = auth.currentUser?.uid;
    if (!uid) throw new Error("æœªãƒ­ã‚°ã‚¤ãƒ³ã§ã™");
    const snap = await getDocs(query(collection(db, `users/${uid}/${path}`), limit(50)));
    const docs = snap.docs;
    if (!docs.length) throw new Error(`${path} ãŒç©ºã§ã™`);
    return rnd(docs).data();
}

pullBtn.addEventListener('click', async () => {
    try{
        if (targetSource.value === 'favs') {
            const d = await getRandomDoc('favs');
            manualTopic.value = d.title || d.content?.slice(0,40) || 'ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰';
        } else if (targetSource.value === 'journals') {
            const d = await getRandomDoc('journals');
            manualTopic.value = d.title || d.content?.slice(0,40) || 'ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰';
        } else {
            alert('ã‚½ãƒ¼ã‚¹ãŒ Favs / Journals ã®ã¨ãã ã‘å–å¾—ã§ãã¾ã™');
        }
    }catch(e){ alert('ãƒ©ãƒ³ãƒ€ãƒ å–å¾—ã‚¨ãƒ©ãƒ¼ï¼š' + e.message); }
});

function drawPerspectives(topic, candidates, n, autoTitle){
    // å€™è£œã‹ã‚‰é‡è¤‡ãªã—ã§ n æŠ½é¸
    const pool = [...candidates];
    const picks = [];
    for(let i=0;i<n && pool.length;i++){
        const idx = Math.floor(Math.random()*pool.length);
        const tag = pool.splice(idx,1)[0];
        const label = LABEL[tag];
        const qset  = QUESTIONS[tag];
        const chosenQs = qset.sort(()=>Math.random()-0.5).slice(0,2); // 2å•ã ã‘
        const title = autoTitle ? `ã€${topic}ï¼š${label}è¦–ç‚¹ã€` : null;
        const flavor = autoTitle ? `ã‚¸ãƒ£ãƒ³ãƒ«ï¼š${rnd(GENRES)}ï¼èˆå°ï¼š${rnd(SETTINGS)}ï¼ãƒˆãƒ¼ãƒ³ï¼š${rnd(TONES)}` : null;
        picks.push({ tag, label, title, topic, desc: DESC[tag], questions: chosenQs, flavor });
    }
    return picks;
}

function render(picks){
    resultEl.innerHTML = picks.map((p,i)=>(
        `<div class="card">
            <div class="pill">#${i+1} ${p.tag} â€“ ${p.label}</div>
            ${p.title ? `<h2>${escapeHtml(p.title)}</h2><p class="muted">${escapeHtml(p.flavor||"")}</p>` : ``}
            <p>${escapeHtml(p.desc)}</p>
            <ul>${p.questions.map(q=>`<li>${escapeHtml(q)}</li>`).join('')}</ul>
            <p class="muted small">ãƒ¡ãƒ¢ï¼š${escapeHtml(p.topic)}</p>
        </div>`
    )).join('');
    resultEl.dataset.raw = JSON.stringify(picks);
}

drawBtn.addEventListener('click', () => {
    const topic = (manualTopic.value||'').trim();
    if (!topic) { alert('ãŠé¡Œã‚’å…¥åŠ›ã™ã‚‹ã‹ã€Favs/Journalsã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„'); return; }
    const candidates = chk();
    if (!candidates.length){ alert('å°‘ãªãã¨ã‚‚1ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§ãã ã•ã„'); return; }
    const n = parseInt(numPicksSel.value,10);
    const picks = drawPerspectives(topic, candidates, n, autoTitleChk.checked);
    render(picks);
});

copyBtn.addEventListener('click', async () => {
    const raw = resultEl.dataset.raw;
    if (!raw) { alert('ã¾ãšã‚¬ãƒãƒ£ã‚’å›ã—ã¦ãã ã•ã„'); return; }
    const picks = JSON.parse(raw);
    const text = picks.map((p,i)=>[
        `#${i+1} ${p.tag} â€“ ${p.label}`,
        p.title ? p.title : '',
        p.flavor ? p.flavor : '',
        p.desc,
        'â–  å•ã„',
        ...p.questions.map(q=>`- ${q}`),
        `â–  ãŠé¡Œãƒ¡ãƒ¢: ${p.topic}`
    ].filter(Boolean).join('\n')).join('\n\n---\n\n');
    await navigator.clipboard.writeText(text);
    alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
});

saveBtn.addEventListener('click', async () => {
    const raw = resultEl.dataset.raw;
    if (!raw) { alert('ã¾ãšè¦–ç‚¹ã‚¬ãƒãƒ£ã‚’å›ã—ã¦ãã ã•ã„'); return; }

    const u = auth.currentUser;
    if (!u) { alert('æœªãƒ­ã‚°ã‚¤ãƒ³ã§ã™'); return; }

saveBtn.disabled = true;
try {
    const picks = JSON.parse(raw); // drawå¾Œã«renderãŒå…¥ã‚Œã¦ãã‚Œã¦ã‚‹é…åˆ—
    const topic = (manualTopic.value || 'ç„¡é¡Œ').trim();

    // ã‚¿ã‚¤ãƒˆãƒ«ï¼šãŠé¡Œ Ã— ä½¿ã£ãŸè¦–ç‚¹ã‚¿ã‚°
    const title = `ä½œå“æ¡ˆï¼š${topic} Ã— ${picks.map(p => p.tag).join('+')}`;

    // æœ¬æ–‡ï¼šå„è¦–ç‚¹ã®èª¬æ˜ãƒ»å•ã„ãƒ»è‡ªå‹•ç”Ÿæˆã®ã‚¿ã‚¤ãƒˆãƒ«/ã‚ã‚‰ã™ã˜ã‚’çµåˆ
    const content = picks.map((p, i) => [
        `#${i+1} ${p.tag} â€“ ${p.label}`,
        p.genTitle   ? `ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆï¼š${p.genTitle}` : (p.title ? `ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆï¼š${p.title}` : ''),
        p.genSynopsis? `ã‚ã‚‰ã™ã˜ï¼š${p.genSynopsis}` : (p.body  ? `ã‚ã‚‰ã™ã˜ï¼š\n${p.body}`  : ''),
        p.flavor     ? `ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ï¼š${p.flavor}` : '',
        p.desc       ? `è¦–ç‚¹ã®èª¬æ˜ï¼š${p.desc}` : '',
        (p.questions && p.questions.length)
        ? ['â–  å•ã„', ...p.questions.map(q => `- ${q}`)].join('\n')
        : '',
    `â–  ãŠé¡Œãƒ¡ãƒ¢: ${p.topic || topic}`
    ].filter(Boolean).join('\n')).join('\n\n---\n\n');

    await addDoc(collection(db, `users/${u.uid}/ideas`), {
        title,
        content,
        topic,
        tags: picks.map(p => p.tag),     // ä¾‹: ["S","R"]
        createdAt: serverTimestamp(),
        source: 'SCAMPER_PERSPECTIVE_GACHA'
    });

    alert('ä½œå“æ¡ˆã«ä¿å­˜ã—ã¾ã—ãŸï¼');
    } catch (e) {
        alert('ä¿å­˜ã‚¨ãƒ©ãƒ¼ï¼š' + e.message);
    } finally {
        saveBtn.disabled = false;
    }
});

</script>
</body>
</html>